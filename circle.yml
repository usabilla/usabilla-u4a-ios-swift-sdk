machine:
  xcode:
    version: 8.3.2
dependencies:
  pre: 
    - gem install slather
  override:
    - bin/bootstrap-if-needed
  cache_directories:
    - "Carthage"
test:
    post:
    - slather coverage --verbose
    - bash <(curl -s https://codecov.io/bash) -f xml_report/cobertura.xml -X coveragepy -X gcov -X xcode -t $CODE_COV_TOKEN
    override:
      - set -o pipefail &&
        xcodebuild
          CODE_SIGNING_REQUIRED=NO
          CODE_SIGN_IDENTITY=
          PROVISIONING_PROFILE=
          -sdk iphonesimulator
          -destination 'platform=iOS Simulator,OS=9.0,name=iPhone 6'
          -workspace UsabillaFeedbackForm.xcworkspace
          -scheme "UsabillaFeedbackForm"
          test |
        tee $CIRCLE_ARTIFACTS/xcode_raw_ut.log |
        xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results_ut_ios_9_0_iPhone_6.xml

      - set -o pipefail &&
        xcodebuild
          CODE_SIGNING_REQUIRED=NO
          CODE_SIGN_IDENTITY=
          PROVISIONING_PROFILE=
          -sdk iphonesimulator
          -destination 'platform=iOS Simulator,OS=10.3,name=iPhone 7'
          -workspace UsabillaFeedbackForm.xcworkspace
          -scheme "UsabillaFeedbackForm"
          test |
        tee $CIRCLE_ARTIFACTS/xcode_raw_ut.log |
        xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results_ut_ios_10_3_iPhone_7.xml

      - set -o pipefail &&
        xcodebuild
          CODE_SIGNING_REQUIRED=NO
          CODE_SIGN_IDENTITY=
          PROVISIONING_PROFILE=
          -sdk iphonesimulator
          -destination 'platform=iOS Simulator,OS=9.0,name=iPhone 6'
          -workspace UsabillaFeedbackForm.xcworkspace
          -scheme "UsabillaFeedbackFormUITestApp"
          test |
        tee $CIRCLE_ARTIFACTS/xcode_raw_ui.log |
        xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results_ui.xml
